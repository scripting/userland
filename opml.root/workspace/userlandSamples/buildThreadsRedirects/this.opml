<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- OPML generated by OPML Editor v10.1b19 on Sat, 03 Jun 2017 03:26:02 GMT -->
<opml version="2.0">
	<head>
		<title>workspace.userlandSamples.buildThreadsRedirects</title>
		<dateCreated>Mon, 03 Sep 2012 16:00:13 GMT</dateCreated>
		<dateModified>Sat, 03 Jun 2017 03:26:02 GMT</dateModified>
		<ownerName>Dave Winer</ownerName>
		<ownerId>http://davewiner.com/</ownerId>
		<expansionState>1, 2, 3, 6, 14</expansionState>
		<vertScrollState>1</vertScrollState>
		<windowTop>113</windowTop>
		<windowLeft>811</windowLeft>
		<windowBottom>714</windowBottom>
		<windowRight>1962</windowRight>
		</head>
	<body>
		<outline text="on buildThreadsRedirects (adroutline)">
			<outline text="Changes" isComment="true">
				<outline text="9/3/12; 12:00:16 PM by DW">
					<outline text="Builds redirects from the new threads site to posts on the original one.">
						<outline text="http://worknotes.scripting.com/september2012/9312ByDw/workingOnThreads"/>
						</outline>
					</outline>
				</outline>
			<outline text="local (adrcal = @scratchpad.calendar)"/>
			<outline text="bundle //build the calendar from the outline">
				<outline text="new (tabletype, adrcal)"/>
				<outline text="target.set (adroutline)"/>
				<outline text="op.firstsummit ()"/>
				<outline text="op.collapse ()"/>
				<outline text="op.expand (2) "/>
				<outline text="op.go (right, 1)"/>
				<outline text="loop">
					<outline text="local (parentname = string.innerCaseName (string.replaceall (op.getlinetext (), &quot;/&quot;, &quot;&quot;)))"/>
					<outline text="if op.go (right, 1)">
						<outline text="loop">
							<outline text="msg (op.getlinetext ())" isComment="true"/>
							<outline text=""/>
							<outline text="local (atts)"/>
							<outline text="op.attributes.getall (@atts)"/>
							<outline text="local (adrday = mainresponder.calendar.getdayaddress (adrcal, date (atts.created)))"/>
							<outline text="local (adritem = @adrday^.[atts.name])"/>
							<outline text="atts.parentname = parentname"/>
							<outline text="atts.text = op.getlinetext ()"/>
							<outline text="adritem^ = atts"/>
							<outline text=""/>
							<outline text="if not op.go (down, 1)">
								<outline text="break"/>
								</outline>
							</outline>
						<outline text="op.go (left, 1)"/>
						</outline>
					<outline text="if not op.go (down, 1)">
						<outline text="break"/>
						</outline>
					</outline>
				</outline>
			<outline text="bundle //build an outline with redirects">
				<outline text="adroutline = @scratchpad.newthreadsoutline"/>
				<outline text="new (outlinetype, adroutline)"/>
				<outline text="target.set (adroutline)"/>
				<outline text="for adryear in adrcal">
					<outline text="op.insert (nameof (adryear^), up)"/>
					<outline text="for adrmonth in adryear">
						<outline text="local (dir = right)"/>
						<outline text="op.insert (date.monthToString (number (nameof (adrmonth^))), right)"/>
						<outline text="for adrday in adrmonth">
							<outline text="for adrpost in adrday">
								<outline text="local (atts)"/>
								<outline text="new (tabletype, @atts)"/>
								<outline text="atts.type = &quot;redirect&quot;"/>
								<outline text="http://threads.scripting.com/61712ByDw/newOrleansBlogs" isComment="true"/>
								<outline text="atts.url = &quot;http://threads.scripting.com/&quot; + adrpost^.parentname + &quot;/&quot; + adrpost^.name"/>
								<outline text="atts.created = adrpost^.created"/>
								<outline text="atts.pgfnum = adrpost^.pgfnum"/>
								<outline text="op.insert (adrpost^.text, dir); dir = up"/>
								<outline text="op.attributes.addgroup (@atts)"/>
								</outline>
							</outline>
						<outline text="op.go (left, 2)"/>
						</outline>
					<outline text="op.go (left, 1)"/>
					</outline>
				<outline text="edit (adroutline)"/>
				</outline>
			</outline>
		<outline text="bundle //test code">
			<outline text="local (adroutline = @system.temp.op.netOutlines.[&quot;http://static.reallysimple.org/worldoutline/dave/2012/06/09/archive109.opml&quot;].outline)"/>
			<outline text="buildThreadsRedirects (adroutline)"/>
			</outline>
		</body>
	</opml>
