<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- OPML generated by OPML Editor v10.1b19 on Sat, 03 Jun 2017 03:39:13 GMT -->
<opml version="2.0">
	<head>
		<title>workspace.userlandSamples.readChangesXml</title>
		<dateCreated>Mon, 11 Feb 2002 19:47:57 GMT</dateCreated>
		<dateModified>Sat, 03 Jun 2017 03:39:13 GMT</dateModified>
		<ownerName>Dave Winer</ownerName>
		<ownerId>http://davewiner.com/</ownerId>
		<expansionState>1, 12, 17</expansionState>
		<vertScrollState>1</vertScrollState>
		<windowTop>50</windowTop>
		<windowLeft>50</windowLeft>
		<windowBottom>470</windowBottom>
		<windowRight>550</windowRight>
		</head>
	<body>
		<outline text="10/2/01; 9:47:17 AM by DW" isComment="true">
			<outline text="Sample script, reads the changes.xml file managed by Weblogs.Com."/>
			<outline text="It creates a table at scratchpad.weblogUpdates, each sub-table represents one weblog that changed."/>
			<outline text="See http://newhome.weblogs.com/ for more information."/>
			</outline>
		<outline text=""/>
		<outline text="local (adrtable = @scratchpad.weblogUpdates)"/>
		<outline text="local (s = tcp.httpReadUrl (&quot;http://static.userland.com/weblogs/changes.xml&quot;))"/>
		<outline text="xml.compile (s, @xstruct)"/>
		<outline text="local (adrroot = xml.getaddress (@xstruct, &quot;weblogUpdates&quot;))"/>
		<outline text="local (whenxmlfilechanged = date (xml.getattribute (adrroot, &quot;updated&quot;)^))"/>
		<outline text="local (loglist = xml.getaddresslist (adrroot, &quot;weblog&quot;), adrxlog)"/>
		<outline text="on untaint (s)">
			<outline text="s = string.replaceAll (s, &quot;{&quot;, &quot;&amp;#123;&quot;)"/>
			<outline text="s = html.neuterJavaScript (s)"/>
			<outline text="return (s)"/>
			</outline>
		<outline text="new (tabletype, adrtable)"/>
		<outline text="for adrxlog in loglist">
			<outline text="local (url = untaint (xml.getattribute (adrxlog, &quot;url&quot;)^))"/>
			<outline text="local (name = untaint (xml.getattribute (adrxlog, &quot;name&quot;)^))"/>
			<outline text="local (when = number (xml.getattribute (adrxlog, &quot;when&quot;)^))"/>
			<outline text="local (whenthisweblogchanged = whenxmlfilechanged - when)"/>
			<outline text="if whenthisweblogchanged &gt; clock.now ()">
				<outline text="whenthisweblogchanged = clock.now ()"/>
				</outline>
			<outline text=""/>
			<outline text="local (day, month, year, hour, minute, second)"/>
			<outline text="date.get (whenthisweblogchanged, @day, @month, @year, @hour, @minute, @second)"/>
			<outline text="nameitem = year + &quot;.&quot; + string.padwithzeros (month, 2) + &quot;.&quot; + string.padwithzeros (day, 2) + &quot;.&quot; + string.padwithzeros (hour, 2) + &quot;.&quot; + string.padwithzeros (minute, 2) + &quot;.&quot; + string.padwithzeros (second, 2)"/>
			<outline text=""/>
			<outline text="local (adrsubtable = @adrtable^.[nameitem])"/>
			<outline text="new (tabletype, adrsubtable)"/>
			<outline text="adrsubtable^.sitename = xml.entitydecode (name, true)"/>
			<outline text="adrsubtable^.siteurl = xml.entitydecode (url, true)"/>
			<outline text="adrsubtable^.timeupdate = whenthisweblogchanged"/>
			</outline>
		</body>
	</opml>
