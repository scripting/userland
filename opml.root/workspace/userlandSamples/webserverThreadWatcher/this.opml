<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- OPML generated by OPML Editor v10.1b19 on Fri, 02 Jun 2017 19:27:15 GMT -->
<opml version="2.0">
	<head>
		<title>workspace.userlandSamples.webserverThreadWatcher</title>
		<dateCreated>Fri, 24 Feb 2012 21:01:46 GMT</dateCreated>
		<dateModified>Fri, 24 Feb 2012 21:33:21 GMT</dateModified>
		<ownerName>Dave Winer</ownerName>
		<ownerId>http://davewiner.com/</ownerId>
		<expansionState>1, 2, 3, 7, 9, 14, 16, 18, 21, 23</expansionState>
		<vertScrollState>1</vertScrollState>
		<windowTop>172</windowTop>
		<windowLeft>373</windowLeft>
		<windowBottom>810</windowBottom>
		<windowRight>1088</windowRight>
		</head>
	<body>
		<outline text="on webserverThreadWatcher (pta)">
			<outline text="Changes" isComment="true">
				<outline text="2/24/12; 4:42:36 PM by DW">
					<outline text="A sample script that runs when ever a hit comes into your server. It keeps a table at system.temp.threadtable, which it opens when it creates it, that has one entry for each active thread. If a thread hangs around for a long time that could be a sign of a problem.">
						<outline text="http://worknotes.scripting.com/february2012/22412ByDw/threadwatcherSampleScript/"/>
						</outline>
					</outline>
				</outline>
			<outline text="local (adrtable = @system.temp.threadtable)"/>
			<outline text="scratchpad.threadwatcherparams = pta^ //debugging" isComment="true"/>
			<outline text="bundle //add the thread to the table">
				<outline text="local (url = pta^.host + pta^.uri, adrsub, flnew = false)"/>
				<outline text="if not defined (adrtable^)">
					<outline text="new (tabletype, adrtable)"/>
					<outline text="flnew = true"/>
					</outline>
				<outline text="adrsub = @adrtable^.[thread.getCurrentID ()]"/>
				<outline text="adrsub^ = url"/>
				<outline text="if flnew">
					<outline text="edit (adrtable)"/>
					</outline>
				</outline>
			<outline text="bundle //delete items if the thread it represents is gone">
				<outline text="local (i, adrsub, id)"/>
				<outline text="for i = sizeof (adrtable^) downto 1">
					<outline text="adrsub = @adrtable^ [i]"/>
					<outline text="id = nameof (adrsub^)"/>
					<outline text="if not thread.exists (id)">
						<outline text="delete (adrsub)"/>
						</outline>
					</outline>
				</outline>
			</outline>
		<outline text="bundle //test code">
			<outline text="user.webserver.preFilters.threadWatcher = this"/>
			</outline>
		</body>
	</opml>
