<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- OPML generated by OPML Editor v10.1b19 on Sat, 03 Jun 2017 03:36:13 GMT -->
<opml version="2.0">
	<head>
		<title>workspace.userlandSamples.downloadLinkblogArchive</title>
		<dateCreated>Sat, 13 Oct 2012 16:38:28 GMT</dateCreated>
		<dateModified>Sat, 03 Jun 2017 03:36:13 GMT</dateModified>
		<ownerName>Dave Winer</ownerName>
		<ownerId>http://davewiner.com/</ownerId>
		<expansionState>1, 2, 3, 4, 14, 18, 23</expansionState>
		<vertScrollState>1</vertScrollState>
		<windowTop>223</windowTop>
		<windowLeft>363</windowLeft>
		<windowBottom>802</windowBottom>
		<windowRight>1140</windowRight>
		</head>
	<body>
		<outline text="on downloadLinkblogArchive (urlFeed, folder)">
			<outline text="Changes" isComment="true">
				<outline text="10/13/12; 12:38:32 PM by DW">
					<outline text="Download a linkblog that has an archive element at the top leve. ">
						<outline text="http://threads2.scripting.com/2012/october/myLinkblogHasAnArchive"/>
						</outline>
					</outline>
				</outline>
			<outline text="local (xmltext = tcp.httpreadurl (urlfeed, 3, false))"/>
			<outline text="xml.compile (xmltext, @xstruct)"/>
			<outline text="scratchpad.xstruct = xstruct" isComment="true"/>
			<outline text="local (adrrss = xml.getaddress (@xstruct, &quot;rss&quot;))"/>
			<outline text="local (adrchannel  = xml.getaddress (adrrss, &quot;channel&quot;))"/>
			<outline text="local (adrarchive  = xml.getaddress (adrchannel, &quot;archive&quot;))"/>
			<outline text="local (urlarchive = xml.getvalue (adrarchive, &quot;url&quot;))"/>
			<outline text="local (fname = xml.getvalue (adrarchive, &quot;filename&quot;))"/>
			<outline text="on getdate (name)">
				<outline text="local (s = xml.getvalue (adrarchive, name))"/>
				<outline text="return (date.set (string.nthfield (s, &quot;-&quot;, 3), string.nthfield (s, &quot;-&quot;, 2), string.nthfield (s, &quot;-&quot;, 1), 0, 0, 0))"/>
				</outline>
			<outline text="local (theday = getdate (&quot;startDay&quot;), endday = getdate (&quot;endDay&quot;))"/>
			<outline text="loop">
				<outline text="local (urlday = urlarchive + file.getdatepath (&quot;/&quot;, theday) + fname)"/>
				<outline text="local (fday = folder + file.getdatepath (file.getpathchar (), theday, false) + &quot;.xml&quot;)"/>
				<outline text="try">
					<outline text="local (xmltext = tcp.httpreadurl (urlday, 3, false))"/>
					<outline text="file.surefilepath (fday) //make sure all folders in path exist"/>
					<outline text="file.writewholefile (fday, xmltext)"/>
					<outline text="bundle //set mod and creation dates">
						<outline text="local (xstruct, adrrss, adrchannel)"/>
						<outline text="xml.compile (xmltext, @xstruct)"/>
						<outline text="adrrss = xml.getaddress (@xstruct, &quot;rss&quot;)"/>
						<outline text="adrchannel  = xml.getaddress (adrrss, &quot;channel&quot;)"/>
						<outline text="file.setcreated (fday, date (xml.getvalue (adrchannel, &quot;pubDate&quot;)))"/>
						<outline text="file.setmodified (fday, date (xml.getvalue (adrchannel, &quot;lastBuildDate&quot;)))"/>
						</outline>
					<outline text="msg (fday)"/>
					</outline>
				<outline text="theday = date.tomorrow (theday)"/>
				<outline text="if theday &gt; endday">
					<outline text="break"/>
					</outline>
				</outline>
			</outline>
		<outline text="bundle //test code">
			<outline text="downloadLinkblogArchive (&quot;http://links.scripting.com/rss.xml&quot;, &quot;Ohio:mylinkblog:&quot;)"/>
			</outline>
		</body>
	</opml>
