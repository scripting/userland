<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- OPML generated by OPML Editor v10.1b19 on Sat, 03 Jun 2017 03:26:06 GMT -->
<opml version="2.0">
	<head>
		<title>workspace.userlandSamples.fixFilePathsAndAddresses</title>
		<dateCreated>Mon, 11 Feb 2002 19:48:02 GMT</dateCreated>
		<dateModified>Sat, 03 Jun 2017 03:26:06 GMT</dateModified>
		<ownerName>Dave Winer</ownerName>
		<ownerId>http://davewiner.com/</ownerId>
		<expansionState>1, 10</expansionState>
		<vertScrollState>1</vertScrollState>
		<windowTop>50</windowTop>
		<windowLeft>50</windowLeft>
		<windowBottom>470</windowBottom>
		<windowRight>550</windowRight>
		</head>
	<body>
		<outline text="Changes:" isComment="true">
			<outline text="1/3/02; 4:57:07 PM by DW">
				<outline text="Change &quot;playlist&quot; to &quot;radio&quot;."/>
				</outline>
			<outline text="3/4/01; 5:37:46 PM by JES">
				<outline text="Fixed an error if user.backups or user.batchExporter aren't defined."/>
				</outline>
			<outline text="1/21/01; 4:02:08 AM by JES" isComment="true">
				<outline text="Fix preferences, addresses and filespecs in Radio.root, MyUserLand.root and Weblog.root, after having renamed or moved the Radio UserLand application folder."/>
				<outline text="How to use this script:">
					<outline text="Make sure that Radio.root is up-to-date using the Update Radio.root command in the file menu."/>
					<outline text="Quit Radio UserLand, and move or rename the application folder as needed, taking note of the old path to the application folder."/>
					<outline text="Launch Radio UserLand and run this script. A dialog will appear, asking for the old Radio UserLand application folder path. The default should be correct, but if it isn't, then enter the correct path."/>
					<outline text="If all goes well, a few seconds after clicking the OK button, a dialog will appear telling you that your data has been successfully updated."/>
					</outline>
				</outline>
			</outline>
		<outline text=""/>
		<outline text="local (oldAppFolder = string.mid (user.radio.prefs.wwwFolder, 1, sizeOf (user.radio.prefs.wwwFolder) - 4))"/>
		<outline text="local (lowerOldAppFolder = string.lower (oldAppFolder))"/>
		<outline text="local (currentAppFolder = system.verbs.builtins.Frontier.pathstring)"/>
		<outline text=""/>
		<outline text="if dialog.ask (&quot;Enter the old Radio UserLand application folder path:&quot;, @oldAppFolder)">
			<outline text=""/>
			<outline text="on fixAddress (adrAddress)">
				<outline text="try" isComment="true"/>
				<outline text="if string.lower (adrAddress^) beginsWith &quot;[\&quot;&quot; + lowerOldAppFolder">
					<outline text="local (s = string (adrAddress^))"/>
					<outline text="local (ix = string.patternMatch (&quot;\&quot;].&quot;, s))"/>
					<outline text="if ix &gt; 0">
						<outline text="s = string.delete (s, 1, ix + 2)"/>
						</outline>
					<outline text="adrAddress^ = address (s)"/>
					</outline>
				</outline>
			<outline text="on fixString (adrString)">
				<outline text="try" isComment="true"/>
				<outline text="if string.lower (adrString^) beginsWith lowerOldAppFolder">
					<outline text="adrString^ = currentAppFolder + string.delete (adrString^, 1, sizeOf (oldAppFolder))"/>
					</outline>
				</outline>
			<outline text="on fixFilespec (adrFilespec)">
				<outline text="try" isComment="true"/>
				<outline text="if string.lower (adrFilespec^) beginsWith lowerOldAppFolder">
					<outline text="adrFilespec^ = filespec (currentAppFolder + string.delete (adrFilespec^, 1, sizeOf (oldAppFolder)))"/>
					</outline>
				</outline>
			<outline text="on fixObject (adrObject)">
				<outline text="case typeOf (adrObject^)">
					<outline text="addressType">
						<outline text="return (fixAddress (adrObject))"/>
						</outline>
					<outline text="stringType">
						<outline text="return (fixString (adrObject))"/>
						</outline>
					<outline text="filespecType">
						<outline text="return (fixFilespec (adrObject))"/>
						</outline>
					</outline>
				</outline>
			<outline text=""/>
			<outline text="local (adrItem, pc = file.getPathChar ())"/>
			<outline text=""/>
			<outline text="bundle //fix items in MyUserLandData.root">
				<outline text="if defined (myUserLandData)">
					<outline text="myUserLandData.prefs.enclosureFolder = currentAppFolder + &quot;Downloaded enclosures&quot; + pc"/>
					<outline text="myUserLandData.stats.imagesFolder = currentAppFolder + &quot;www&quot; + pc + &quot;images&quot; + pc"/>
					<outline text="local (ct = 0)"/>
					<outline text="for adrItem in @myUserLandData.stories //fix enclosures">
						<outline text="if (++ct % 1000) == 0">
							<outline text="msg (&quot;Fixing channel enclosure paths: &quot; + ct)"/>
							<outline text="fileMenu.saveMyRoot (@myUserLandData)"/>
							</outline>
						<outline text="if defined (adrItem^.enclosure)">
							<outline text="if defined (adrItem^.enclosure.f)">
								<outline text="fixObject (@adrItem^.enclosure.f)"/>
								</outline>
							</outline>
						</outline>
					<outline text="msg (&quot;Saving...&quot;)"/>
					<outline text="fileMenu.saveMyRoot (@myUserLandData)"/>
					</outline>
				</outline>
			<outline text="bundle //fix folder paths in Weblog sites' #ftpSite tables">
				<outline text="if defined (weblogData.sites)">
					<outline text="msg (&quot;Fixing Weblog folders...&quot;)"/>
					<outline text="for adrItem in @weblogData.sites">
						<outline text="if defined (adrItem^.website.[&quot;#ftpSite&quot;])">
							<outline text="if defined (adrItem^.website.[&quot;#ftpSite&quot;].folder)">
								<outline text="fixObject (@adrItem^.website.[&quot;#ftpSite&quot;].folder)"/>
								</outline>
							</outline>
						</outline>
					<outline text="fileMenu.saveMyRoot (@weblogData)"/>
					</outline>
				</outline>
			<outline text="bundle //fix items in the user table">
				<outline text="msg (&quot;Fixing the user table...&quot;)"/>
				<outline text="if defined (user.backups)">
					<outline text="fixObject (@user.backups.folder)"/>
					</outline>
				<outline text="if defined (user.batchExporter)">
					<outline text="fixObject (@user.batchExporter.folder)"/>
					</outline>
				<outline text="for adrItem in @user.betty.rpcHandlers">
					<outline text="fixObject (adrItem)"/>
					</outline>
				<outline text="for adrItem in @user.callbacks">
					<outline text="local (adrCallback)"/>
					<outline text="for adrCallback in adrItem">
						<outline text="fixObject (adrCallback)"/>
						</outline>
					</outline>
				<outline text="if defined (user.html.callbacks.fileWriters.ftp.write)">
					<outline text="for adrItem in @user.html.callbacks.fileWriters.ftp.write">
						<outline text="fixObject (adrItem)"/>
						</outline>
					</outline>
				<outline text="if defined (user.html.prefs.lastImportedFolder)">
					<outline text="fixObject (@user.html.prefs.lastImportedFolder)"/>
					</outline>
				<outline text="if defined (user.log)">
					<outline text="if defined (user.log.prefs)">
						<outline text="user.log.prefs.folder = currentAppFolder + &quot;Logs&quot; + pc"/>
						</outline>
					</outline>
				<outline text="for adrItem in @user.pike.commandCallbacks">
					<outline text="local (adrCallback)"/>
					<outline text="for adrCallback in adrItem">
						<outline text="fixObject (adrCallback)"/>
						</outline>
					</outline>
				<outline text="if defined (user.playlist.data.upstream.magicFolders)" isComment="true">
					<outline text="for adrItem in @user.playlist.data.upstream.magicFolders">
						<outline text="fixObject (adrItem)"/>
						</outline>
					</outline>
				<outline text="if defined (user.webserver.responders.websiteFramework)">
					<outline text="for adrItem in @user.webserver.responders.websiteFramework.data.docTree">
						<outline text="fixObject (adrItem)"/>
						</outline>
					</outline>
				<outline text=""/>
				<outline text="do this last, since this is how we tell if the app folder has changed" isComment="true"/>
				<outline text="user.radio.prefs.wwwFolder = currentAppFolder + &quot;www&quot; + pc"/>
				<outline text=""/>
				<outline text="fileMenu.saveMyRoot (@user)"/>
				</outline>
			<outline text="msg (&quot;&quot;)"/>
			<outline text=""/>
			<outline text="dialog.alert (&quot;Your data has been successfully updated for the new application folder.&quot;)"/>
			</outline>
		</body>
	</opml>
