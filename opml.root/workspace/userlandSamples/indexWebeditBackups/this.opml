<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- OPML generated by OPML Editor v10.1b19 on Sat, 03 Jun 2017 03:19:14 GMT -->
<opml version="2.0">
	<head>
		<title>workspace.userlandSamples.indexWebeditBackups</title>
		<dateCreated>Fri, 08 Jun 2012 19:14:54 GMT</dateCreated>
		<dateModified>Sat, 03 Jun 2017 03:19:14 GMT</dateModified>
		<ownerName>Dave Winer</ownerName>
		<ownerId>http://davewiner.com/</ownerId>
		<expansionState>1, 2, 3</expansionState>
		<vertScrollState>1</vertScrollState>
		<windowTop>101</windowTop>
		<windowLeft>1301</windowLeft>
		<windowBottom>533</windowBottom>
		<windowRight>2192</windowRight>
		</head>
	<body>
		<outline text="on indexWebeditBackups (folder, cutoffdate)">
			<outline text="Changes" isComment="true">
				<outline text="6/8/12; 3:14:57 PM by DW">
					<outline text="Run this when you want to create a list of updated parts from a Webedit Backups folder."/>
					</outline>
				</outline>
			<outline text="local (cutoffday, cutoffmonth, cutoffyear, hour, minute, second, day, month, year)"/>
			<outline text="local (pc = file.getpathchar (), adroutline = @scratchpad.indexoutline)"/>
			<outline text="on popfile (s)">
				<outline text="local (pattern = &quot;\&quot;].&quot;, ix = string.patternmatch (pattern, s))"/>
				<outline text="if ix &gt; 0">
					<outline text="s = string.delete (s, 1, ix + sizeof (pattern) - 1)"/>
					</outline>
				<outline text="return (s)"/>
				</outline>
			<outline text="bundle //set up outline">
				<outline text="if defined (adroutline^)">
					<outline text="target.set (adroutline)"/>
					<outline text="op.wipe ()"/>
					</outline>
				<outline text="else">
					<outline text="new (outlinetype, adroutline)"/>
					<outline text="target.set (adroutline)"/>
					</outline>
				</outline>
			<outline text="date.get (cutoffdate, @cutoffday, @cutoffmonth, @cutoffyear, @hour, @minute, @second)"/>
			<outline text="for year = cutoffyear downto date.year ()">
				<outline text="for month = 12 downto 1">
					<outline text="for day = 31 downto 1">
						<outline text="local (subfolder = folder + year + pc + string.padwithzeros (month, 2) + pc + string.padwithzeros (day, 2) + pc)"/>
						<outline text="if file.exists (subfolder)">
							<outline text="local (thedate = date.set (day, month, year, 0, 0, 0))"/>
							<outline text="if thedate &gt; cutoffdate">
								<outline text="local (f, dir, changedtoday)"/>
								<outline text="new (tabletype, @changedtoday)"/>
								<outline text="op.insert (date.shortstring (thedate), down); dir = right"/>
								<outline text="fileloop (f in subfolder)">
									<outline text="local (bits = string (file.readwholefile (f)), atts)"/>
									<outline text="if fatPages.getPageAtts (@bits, @atts)">
										<outline text="local (name = popfile (atts.adrPageData))"/>
										<outline text="if not defined (changedtoday.[name])">
											<outline text="op.insert (name, dir); dir = down"/>
											<outline text="changedtoday.[name] = true"/>
											</outline>
										</outline>
									</outline>
								<outline text="if dir == down">
									<outline text="op.sort ()"/>
									<outline text="op.go (left, 1)"/>
									</outline>
								</outline>
							</outline>
						</outline>
					</outline>
				</outline>
			<outline text="op.firstsummit (); op.deleteline ()"/>
			</outline>
		<outline text="bundle //test code">
			<outline text="local (folder = user.prefs.dropboxfolder + &quot;OPML Editor Stuff:Webedit Backups:pensacola:&quot;)"/>
			<outline text="local (cutoffdate = date (&quot;May 29, 2012&quot;))"/>
			<outline text="indexWebeditBackups (folder, cutoffdate)"/>
			</outline>
		</body>
	</opml>
